services:
  openclaw-pentest:
    build: .
    container_name: openclaw-kali-sandbox
    # 核心魔法：socat 监听容器的 18790 端口，并把流量原封不动地转发给 127.0.0.1:18789
    command: sh -c "openclaw gateway --port 18789 --allow-unconfigured & socat TCP-LISTEN:18790,fork,bind=0.0.0.0 TCP:127.0.0.1:18789"
    ports:
      # 把你 Mac 的 18789 映射到容器内 socat 监听的 18790
      - "18789:18790"
    volumes:
      - ./workspace:/workspace
      - ./custom_skills:/root/.openclaw/skills
      - ~/.config/openclaw_kali:/root/.openclaw/config
    deploy:
      resources:
        limits:
          cpus: '2.0'     # 锁死最多使用 2 个核心
          memory: 4G      # 防止内存溢出导致宿主机卡顿
    networks:
      - pentest-net
    restart: unless-stopped

networks:
  pentest-net:
    driver: bridge